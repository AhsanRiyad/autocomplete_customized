<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.0/dist/alpine.min.js" defer></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.4.4/babel.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="./style.css">
    
    <title>Document</title>

</head>
<body>
    <!-- <div x-data="data()"  x-init="$watch('value', value => console.log('i am okay'))" x-init="$watch('items', value => console.log('i am okay'))" >

        <div class="autcomplete">
            <input  x-on:input="valueChange($event.target.value)" x-model="value" class="inputField" placeholder="Country"    />
            <div class="autcomplete_items" >
                <template  x-for="item in items" :key="item">
                    <div class="autcomplete_div" x-text="item.name"></div>
                </template>
            </div>
        </div>

        <div>
            other data
        </div> 
        
    </div> -->
<!-- 
    <div class="flex-container-autcomplete" x-data="data()" x-init="$watch('value', value => console.log('i am okay'))">
        
        <div class="autcomplete1">
            <div>
                <input x-on:input="valueChange($event.target.value)" x-model="value" class="input1" />
            </div>
          <div class="autcomplete_items1">
                <template x-for="item in items" :key="item">
                    <div class="autcomplete_div" x-text="item.name"></div>
                </template>
            </div> 
        </div> 

        <div class="autcomplete2">
            <div>
                <input class="input2" />
            </div>
            <div>
                this is another
            </div>
        </div>
        <div>
            <button class="button1"> Submit </button>
        </div>

    </div> -->

    <div class="autcomplete-position-xyz" x-data="data()">
        <div class="auto1-xyz">
            <input x-on:keydown.enter="categoryKeyEnter()" x-on:keydown.arrow-down="categoryKeyDown()" x-on:keydown.arrow-up="categoryKeyUp()" x-on:click="categoryFocusIndex = -1" type="text" x-on:input="categoryChange($event.target.value)"  x-model="category" class="inputField-xyz" placeholder="Category" />
            <div class="autocomplete-full-div-xyz" >
                <template x-for="(item , index) in itemsCategory" :key="item">
                    <div :style="categoryFocus(index)" x-on:click="categoryClick(item)" class="autocomplete-items-div-xyz"
                    x-text="item.name"></div>
                </template>
            </div>
        </div>
        <div class="auto2-xyz" > 
            <input x-on:keydown.enter="productKeyEnter()" x-on:keydown.arrow-down="productKeyDown()" x-on:keydown.arrow-up="productKeyUp()"  type="text" x-on:input="productChange($event.target.value)" x-model="product" class="inputField-xyz" placeholder="Product"/>
            <div class="autocomplete-full-div-xyz">
                <template x-for="(item , index) in itemsProduct" :key="item">
                    <div :style="productFocus(index)" x-on:click="productClick(item)" class="autocomplete-items-div-xyz" x-text="item.title"></div>
                </template>
            </div>
        </div>
    <button class="button1-xyz"> Submit </button>
        <div class="clearFix-xyz"></div>
    </div>

</body>

<script>
    function data() {
        return {
            value: "",
            itemsCategory:[],
            itemsProduct:[],
            category: "",
            categoryId: "",
            product: "",
            productId: "",
            productFocusIndex: -1,
            categoryFocusIndex: -1,
            
            itemsProductAll: [
            {
                name: 'Riyad'
            },
            {
                name: 'Maliha'
            },
            {
                name: 'Madhab'
            },
            {
                name: 'Arif'
            },
            {
                name: 'Sazzad'
            },
            ],

            itemsCategoryAll: [
            {
                name: 'Riyad'
            },
            {
                name: 'Maliha'
            },
            {
                name: 'Madhab'
            },
            {
                name: 'Arif'
            },
            {
                name: 'Sazzad'
            },
            ],

            categoryChange(value){
                // this.value = value;
                // this.items.push({ name: value });
                // const regexp = new RegExp(`(${value})*`, 'gi') 
                this.itemsProduct = [];

                if(value == ''){
                    this.categoryId = '';
                    this.itemsCategory = [];
                }else{
                    // http://localhost/n/public/productSearch?productName=Soft&categoryId=7
                    axios('http://localhost/n/public/categorySearch?q=' + value)
                    .then(response => {
                        console.log(response)
                        this.itemsCategory = response.data;
                    });
                }
                // this.itemsCategory = this.itemsCategoryAll.filter(n=> value == n.name);

                console.log('this is new value' , value);
            },
            productChange(value){
                // this.value = value;
                // this.items.push({ name: value });
                // let patt = /(${value})*/gi;

                this.itemsCategory = [];

                // console.log(`http://localhost/n/public/productSearch?productName=${value}&categoryId=${this.categoryId}`);

                axios(`http://localhost/n/public/productSearch?productName=${value}&categoryId=${this.categoryId}`)
                    .then(response => {
                        console.log(response)
                        this.itemsProduct = response.data;
                    });

                // this.itemsProduct = this.itemsProductAll.filter(n=>{n.name == value});

                console.log('this is new value' , value);
            },
            categoryClick(value){
                this.categoryFocusIndex = -1;
                console.log(value.name);
                this.category = value.name;
                this.categoryId = value.id;
                this.itemsCategory = [];
            },
            productClick(value){
                console.log(value.name);
                this.product = value.title;
                this.productId = value.id;
                this.itemsProduct = [];
            },
            categoryFocus(index){
                if(index == this.categoryFocusIndex){
                    return 'background-color: red';
                }else{
                    return 'background-color: white';
                }
            },
            categoryKeyDown(){
                if(this.itemsCategory.length > this.categoryFocusIndex ){
                    this.categoryFocusIndex++;
                }
            },
            categoryKeyUp(){
                if( this.categoryFocusIndex > -1 ){
                    this.categoryFocusIndex--;
                }
            },
            categoryKeyEnter(){
                this.category =  this.itemsCategory[this.categoryFocusIndex].name;
                this.categoryId = this.itemsCategory[this.categoryFocusIndex].id;
                this.itemsCategory = [];
                this.categoryFocusIndex = -1;
            },
            productFocus(index){
                if(index == this.productFocusIndex){
                    return 'background-color: red';
                }else{
                    return 'background-color: white';
                }
            },
            productKeyDown(){
                if(this.itemsProduct.length > this.productFocusIndex ){
                    this.productFocusIndex++;
                }
            },
            productKeyUp(){
                if( this.productFocusIndex > -1 ){
                    this.productFocusIndex--;
                }
            },
            productKeyEnter(){
                this.product =  this.itemsProduct[this.productFocusIndex].title;
                this.productId = this.itemsProduct[this.productFocusIndex].id;
                this.itemsProduct = [];
                this.productFocusIndex = -1;
            }

        }
    }
</script>

</html>